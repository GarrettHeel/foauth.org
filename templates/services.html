{% extends 'base.html' %}

{% block nav %}{{ nav('services') }}{% endblock %}

{% block content %}
			<div class="content">
				<div class="page-header">
					<h1>{{ services|count }} Supported Services</h1>
				</div>
				<p>{% if current_user.is_authenticated() %}You can authorize your services here, and if the service supports it, you can also specify which permissions you&rsquo;d like to authorize. We&rsquo;ll automatically refresh your authorization whenever we can, but not all services support this, so you might have to manually re-authorize services that expire. {% endif %}If you use a service that&rsquo;s not on this list, feel free to <a href="https://github.com/gulopine/foauth.org/issues">request it</a>.</p>
				<div class="services container">
{% for row in services|batch(2) %}
					<div class="row">
{% for alias, service in row %}
{% if current_user.is_authenticated() %}
	{% set key = current_user.key_for_service(alias) %}
{% else %}
	{% set key = None %}
{% endif %}
						<div class="span8 service {% if key %}authorized {% if not key.refresh_token %}{% if key.is_expired() %}expired{% elif key.will_expire() %}expiring{% endif %}{% endif %}{% endif %}">
							<h2>
								{% if not current_user.is_authenticated() %}<img class="favicon" src="{{ service.favicon_url }}">{% endif %}
								{{ service.name }}
								<span class="expires">
									{% if key %}
										{% if key.expires %}
											{% if key.refresh_token %}will refresh{% else %}{% if key.is_expired() %}expired{% else %}will expire{% endif %}{% endif %}
											on {{ key.expires.strftime("%Y-%m-%d") }}
										{% else %}
											has been authorized
										{% endif %}
									{% endif %}
								</span>
							</h2>
							<form action="{{ url_for('authorize', alias=alias) }}" method="post">
							<ul class="permissions">
							{% for scope, perm in service.available_permissions %}
								<li>
								{% if current_user.is_authenticated() %}
								{% if scope or service.permissions_widget == 'radio' %}
									<label><input type="{{ service.permissions_widget }}" name="scope" value="{{ scope or '' }}" {% if not scope %}checked{% endif %}> {{ perm }}</label>
								{% else %}
									<input type="checkbox" checked disabled> {{ perm }}
								{% endif %}
								{% else %}
								{{ perm }}
								{% endif %}
								</li>
							{% endfor %}
							</ul>
							<p class="links">
								<a href="{{ service.provider_url }}">Site</a>
								<a href="{{ service.docs_url }}">API Docs</a>
								{% if current_user.is_authenticated() %}
									{% if key %}
										{% set icon = 'arrow_refresh.png' %}
										{% set title = 'Re-authorize' %}
									{% else %}
										{% set icon = 'key.png' %}
										{% set title = 'Authorize' %}
									{% endif %}
									<button type="submit" class="btn authorize"><img class="favicon" src="{{ service.favicon_url }}"> {{ title }} {{ service.name }}</button>
								{% endif %}
							</p>
							</form>
						</div>
{% endfor %}
					</div>
{% endfor %}
				</div>
			</div>
{% endblock %}
